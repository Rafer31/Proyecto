<mat-tab-group
  class="mt-4"
  [selectedIndex]="selectedTabIndex()"
  (selectedIndexChange)="onTabChange($event)"
>
  <mat-tab>
    <ng-template mat-tab-label>
      <mat-icon class="tab-icon">event_note</mat-icon>
      Viajes Planificados
      <span class="tab-badge">{{ trips().length }}</span>
    </ng-template>

    <div class="header mt-6">
      <h1 class="text-2xl font-bold">Planificación de los viajes</h1>
      <div class="header-actions">
        <button mat-stroked-button color="accent" (click)="openCreateFromTemplateDialog()">
          <mat-icon>bookmark</mat-icon>
          Crear desde Plantilla
        </button>
        <button mat-flat-button color="primary" (click)="openRegisterDialog()">
          <mat-icon>add</mat-icon>
          Planificar viaje
        </button>
      </div>
    </div>

    @if (loading()) {
    <div class="loading-container">
      <mat-spinner diameter="48"></mat-spinner>
      <p>Cargando planificaciones...</p>
    </div>
    } @else if (trips().length === 0) {
    <app-emptystate
      [imageSrc]="'no-trips.svg'"
      [title]="'Aún no hay viajes planificados'"
      [description]="'No se han planificado viajes aún'"
    />
    } @else {
    <div class="cards-grid">
      @for (trip of trips(); track trip.idviaje) {
      <app-planning-card
        [idviaje]="trip.idviaje"
        [fechaViaje]="trip.fechaViaje"
        [destino]="trip.destino"
        [horaPartida]="trip.horapartida"
        [cantdisponibleasientos]="trip.cantdisponibleasientos"
        [tieneRetorno]="trip.tieneRetorno ?? false"
        [esRetorno]="false"
        (editar)="editarViaje(trip.idviaje)"
        (eliminar)="eliminarViaje(trip.idviaje)"
        (actualizarAsientos)="actualizarAsientosDisponibles($event)"
        (guardarPlantilla)="guardarComoPlantilla($event)"
        (exportarReporte)="exportarReporteViaje($event)"
      ></app-planning-card>
      }
    </div>
    }
  </mat-tab>

  <mat-tab>
    <h1 class="text-2xl font-bold">Planificación de los retornos</h1>
    <ng-template mat-tab-label>
      <mat-icon class="tab-icon">keyboard_return</mat-icon>
      Retornos
      <span class="tab-badge">{{ retornos().length }}</span>
    </ng-template>

    @if (loading()) {
    <div class="loading-container">
      <mat-spinner diameter="48"></mat-spinner>
      <p>Cargando retornos...</p>
    </div>
    } @else if (retornos().length === 0) {
    <app-emptystate
      [imageSrc]="'no-trips.svg'"
      [title]="'No hay retornos programados'"
      [description]="'Los retornos se mostrarán aquí una vez programados'"
    />
    } @else {
    <div class="cards-grid">
      @for (retorno of retornos(); track retorno.idviaje) {
      <app-planning-card
        [idviaje]="retorno.idviaje"
        [fechaViaje]="retorno.fechaViaje"
        [destino]="retorno.destino"
        [horaPartida]="retorno.horapartida"
        [cantdisponibleasientos]="retorno.cantdisponibleasientos"
        [tieneRetorno]="false"
        [esRetorno]="true"
        [viajeIdaDestino]="retorno.viajeIdaDestino ?? ''"
        (editar)="editarViaje(retorno.idviaje)"
        (eliminar)="eliminarViaje(retorno.idviaje)"
        (actualizarAsientos)="actualizarAsientosDisponibles($event)"
        (guardarPlantilla)="guardarComoPlantilla($event)"
        (exportarReporte)="exportarReporteViaje($event)"
      ></app-planning-card>
      }
    </div>
    }
  </mat-tab>
</mat-tab-group>
